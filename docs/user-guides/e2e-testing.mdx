---
title: "E2E Testing Guide"
description: "Set up and run end-to-end tests with Playwright for the Control Tower."
icon: "mask"
mode: "wide"
sidebarTitle: "E2E Testing"
---

## Overview

The Control Tower uses Playwright for E2E testing, enabling automated testing of complex workflows, UI interactions, and authentication flows.

## Quick Start

```bash
# Run all tests
bun run test:e2e

# Run with interactive UI
bun run test:e2e:ui

# Run with visible browser
bun run test:e2e:headed

# Debug mode
bun run test:e2e:debug

# Reset test database
bun run test:db:reset
```

## Project Structure

```
e2e/
├── fixtures/          # Test utilities (auth, database)
│   ├── auth.fixture.ts
│   ├── database.fixture.ts
│   └── index.ts
├── pages/             # Page objects for maintainable tests
│   └── dashboard.page.ts
├── tests/             # Test specs organized by feature
│   ├── auth/
│   ├── dashboard/
│   └── workflows/
└── .auth/             # Generated auth state (gitignored)
```

## Configuration

### Test Environment

The `.env.test` file configures the test environment:

- **DATABASE_URL**: Local SQLite file for isolated tests
- **E2E_TEST_MODE**: Enables auth bypass
- **CLERK_BYPASS_AUTH**: Skips real Clerk authentication

### Playwright Config

Key settings in `playwright.config.ts`:

| Setting     | Value                   |
| ----------- | ----------------------- |
| Base URL    | `http://localhost:3000` |
| Browser     | Chromium (default)      |
| Retries     | 2 on CI, 0 locally      |
| Screenshots | On failure              |
| Traces      | On first retry          |

## Writing Tests

### Using Fixtures

```typescript
import { test, expect } from "../../fixtures";
import { DashboardPage } from "../../pages/dashboard.page";

test("should load dashboard", async ({ authenticatedPage }) => {
  const dashboardPage = new DashboardPage(authenticatedPage);
  await dashboardPage.goto();
  await expect(authenticatedPage).toHaveURL(/.*dashboard/);
});
```

### Page Objects

Page objects encapsulate page interactions:

```typescript
const dashboardPage = new DashboardPage(page);
await dashboardPage.navigateToApplicants();
await dashboardPage.navigateToWorkflows();
```

## CI/CD Integration

Tests run automatically on push/PR via GitHub Actions:

- **Workflow file**: `.github/workflows/e2e-tests.yml`
- **Artifacts**: Test reports uploaded on every run
- **Traces**: Uploaded on failure for debugging

## Running Tests Locally

<Steps>
  <Step title="Reset the test database">
    ```bash
    bun run test:db:reset
    ```
  </Step>
  <Step title="Run tests in UI mode">
    ```bash
    bun run test:e2e:ui
    ```

    This opens an interactive interface where you can select and debug tests.
  </Step>
  <Step title="View test report">
    After running tests, open `playwright-report/index.html` for detailed results.
  </Step>
</Steps>

## Test Coverage

Current test suites:

| Suite                          | Description                         |
| ------------------------------ | ----------------------------------- |
| `auth/login.spec.ts`           | Protected routes, public access     |
| `dashboard/navigation.spec.ts` | Dashboard load, sidebar, navigation |

## Troubleshooting

### Tests fail with auth errors

Ensure `.env.test` has `E2E_TEST_MODE=true` and the middleware bypass is configured.

### Database state issues

Run `bun run test:db:reset` to get a fresh database with seed data.

### Browser not installed

```bash
bunx playwright install chromium
```